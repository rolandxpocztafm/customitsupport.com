<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Confirmation - Custom IT Support Mining</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        }
        
        .content-card {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="bg-slate-900 border-b border-slate-700">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <i data-feather="cpu" class="w-8 h-8 text-blue-500 mr-3"></i>
                    <a href="index.html" class="text-xl font-bold text-white">Custom IT Support Mining</a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-slate-300 hover:text-white transition duration-300">
                        <i data-feather="arrow-left" class="w-5 h-5"></i>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <section class="py-16">
        <div class="container mx-auto px-4 max-w-4xl">
            <h1 class="text-3xl font-bold mb-8 text-center">Order Confirmation</h1>
            
            <div class="content-card p-6">
                <div id="order-status" class="text-center py-8">
                    <i data-feather="loader" class="w-8 h-8 text-blue-500 animate-spin mx-auto mb-4"></i>
                    <p>Loading order status...</p>
                </div>
                
                <div id="order-details" class="hidden">
                    <h2 class="text-xl font-bold mb-6 flex items-center">
                        <i data-feather="shopping-cart" class="w-5 h-5 mr-2"></i>
                        Order Summary
                    </h2>
                    <ul id="order-items" class="space-y-4 mb-6"></ul>
                    
                    <div class="border-t border-slate-700 pt-4">
                        <div class="flex justify-between text-lg font-bold">
                            <span>Total:</span>
                            <span id="order-total"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer Placeholder -->
    <div id="footer-container"></div>

    <script>
        feather.replace();
        
        // Load footer dynamically
        fetch('footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer-container').innerHTML = data;
                feather.replace();
            })
            .catch(error => console.error('Error loading footer:', error));

        // Load order status
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('order');
            
            const statusEl = document.getElementById('order-status');
            const detailsEl = document.getElementById('order-details');
            const itemsEl = document.getElementById('order-items');
            const totalEl = document.getElementById('order-total');
            
            if (!orderId) {
                statusEl.innerHTML = `
                    <i data-feather="alert-triangle" class="w-8 h-8 text-red-500 mx-auto mb-4"></i>
                    <h2 class="text-xl font-bold mb-2">Error</h2>
                    <p>No order ID found. Please contact support.</p>
                `;
                feather.replace();
                return;
            }
            
            try {
                const response = await fetch(`/payment-status/${orderId}`);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Order not found');
                }
                
                let message = '';
                let icon = '';
                let color = '';
                
                if (data.status === 'paid') {
                    message = 'Payment successful! Your order has been confirmed.';
                    icon = 'check-circle';
                    color = 'text-green-500';
                } else if (data.status === 'pending' || data.status === 'open') {
                    message = 'Your order has been placed. Awaiting payment confirmation.';
                    icon = 'clock';
                    color = 'text-yellow-500';
                } else if (['canceled', 'failed', 'expired'].includes(data.status)) {
                    message = 'Payment failed or canceled. Please try again or contact support.';
                    icon = 'alert-triangle';
                    color = 'text-red-500';
                } else {
                    message = 'Unknown status. Please contact support.';
                    icon = 'help-circle';
                    color = 'text-blue-500';
                }
                
                statusEl.innerHTML = `
                    <i data-feather="${icon}" class="w-8 h-8 ${color} mx-auto mb-4"></i>
                    <h2 class="text-xl font-bold mb-2">Order #${orderId}</h2>
                    <p>${message}</p>
                `;
                feather.replace();
                
                // Show details if available
                if (data.cart && data.total) {
                    detailsEl.classList.remove('hidden');
                    
                    data.cart.forEach(item => {
                        const itemTotal = item.price * item.quantity;
                        const li = document.createElement('li');
                        li.className = 'flex justify-between items-center py-2 border-b border-slate-700';
                        li.innerHTML = `
                            <div>
                                <div class="font-medium">${item.name}</div>
                                <div class="text-sm text-slate-400">Qty: ${item.quantity}</div>
                            </div>
                            <div class="font-medium">€${itemTotal.toFixed(2)}</div>
                        `;
                        itemsEl.appendChild(li);
                    });
                    
                    totalEl.textContent = `€${data.total.toFixed(2)}`;
                }
            } catch (error) {
                statusEl.innerHTML = `
                    <i data-feather="alert-triangle" class="w-8 h-8 text-red-500 mx-auto mb-4"></i>
                    <h2 class="text-xl font-bold mb-2">Error</h2>
                    <p>${error.message}</p>
                `;
                feather.replace();
            }
        });
    </script>
</body>
</html>
