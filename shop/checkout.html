<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout - Custom IT Support Mining</title>

<link rel="icon" type="image/x-icon" href="/static/favicon.ico">
<script src="https://cdn.tailwindcss.com"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap');

body {
    font-family: 'Space Grotesk', sans-serif;
    background-color: #0f172a;
    color: #e2e8f0;
}

.content-card {
    background: rgba(15, 23, 42, 0.7);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 0.5rem;
}

.form-input {
    background: rgba(15, 23, 42, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: white;
}

.form-input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 1px #3b82f6;
}
</style>
</head>

<body>

<section class="py-16">
<div class="container mx-auto px-4 max-w-6xl">

<h1 class="text-3xl font-bold mb-8 text-center">Checkout</h1>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

<!-- ORDER SUMMARY -->
<div class="content-card p-6">
<h2 class="text-xl font-bold mb-6">Order Summary</h2>

<ul id="checkout-items" class="space-y-4 mb-6"></ul>

<div class="border-t border-slate-700 pt-4 space-y-2">
<div class="flex justify-between">
<span class="text-slate-400">Subtotal:</span>
<span id="subtotal">â‚¬0.00</span>
</div>

<div class="flex justify-between">
<span class="text-slate-400">Shipping:</span>
<span id="shipping">â‚¬0.00</span>
</div>

<div class="flex justify-between">
<span class="text-slate-400">VAT (21%):</span>
<span id="vat">â‚¬0.00</span>
</div>

<div class="flex justify-between text-lg font-bold mt-4 pt-4 border-t border-slate-700">
<span>Total:</span>
<span id="total">â‚¬0.00</span>
</div>
</div>
</div>

<!-- CUSTOMER FORM -->
<div class="content-card p-6">

<h2 class="text-xl font-bold mb-6">Customer Information</h2>

<form 
action="https://formsubmit.co/rp@customitsupport.com" 
method="POST"
class="space-y-4">

<!-- Redirect after submission -->
<input type="hidden" name="_next" value="order-confirmation.html">
<input type="hidden" name="_captcha" value="false">

<!-- Hidden order summary field -->
<textarea name="Order Details" id="order-details" hidden></textarea>

<div>
<label class="block text-sm mb-2">Full Name</label>
<input type="text" name="Full Name" class="w-full p-3 rounded-lg form-input" required>
</div>

<div>
<label class="block text-sm mb-2">Email Address</label>
<input type="email" name="Email" class="w-full p-3 rounded-lg form-input" required>
</div>

<div>
<label class="block text-sm mb-2">Phone</label>
<input type="tel" name="Phone" class="w-full p-3 rounded-lg form-input" required>
</div>

<div>
<label class="block text-sm mb-2">Shipping Address</label>
<textarea name="Address" rows="3" class="w-full p-3 rounded-lg form-input" required></textarea>
</div>

<div>
<label class="block text-sm mb-2">Country</label>
<select name="Country" id="country" class="w-full p-3 rounded-lg form-input" required>
<option value="">Select Country</option>
<option value="NL">Netherlands</option>
<option value="BE">Belgium</option>
<option value="DE">Germany</option>
<option value="FR">France</option>
<option value="ES">Spain</option>
<option value="IT">Italy</option>
<option value="other">Other</option>
</select>
</div>

<div class="grid grid-cols-2 gap-4">
<input type="text" name="Postal Code" placeholder="Postal Code" class="p-3 rounded-lg form-input" required>
<input type="text" name="City" placeholder="City" class="p-3 rounded-lg form-input" required>
</div>

<!-- PAYMENT METHOD -->
<h2 class="text-xl font-bold mt-8 mb-6">Payment Method</h2>

<div class="space-y-3">
<label class="flex items-center">
<input type="radio" name="Payment Method" value="iDEAL" class="mr-3" checked>
iDEAL
</label>

<label class="flex items-center">
<input type="radio" name="Payment Method" value="Bank Transfer" class="mr-3">
Bank Transfer
</label>

<label class="flex items-center">
<input type="radio" name="Payment Method" value="Cash on Delivery" class="mr-3">
Cash on Delivery
</label>
</div>

<button type="submit"
class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-medium mt-8 transition">
Complete Order
</button>

</form>

</div>
</div>
</div>
</section>

<script>
feather.replace();

document.addEventListener("DOMContentLoaded", () => {

const cart = JSON.parse(localStorage.getItem("cart")) || [];
if (cart.length === 0) {
    window.location.href = "cart.html";
    return;
}

const itemsEl = document.getElementById("checkout-items");
let subtotal = 0;

cart.forEach(item => {
    const qty = item.quantity || 1;
    const totalItem = item.price * qty;
    subtotal += totalItem;

    const li = document.createElement("li");
    li.className = "flex justify-between border-b border-slate-700 pb-2";
    li.innerHTML = `
        <span>${item.name} (x${qty})</span>
        <span>â‚¬${totalItem.toFixed(2)}</span>
    `;
    itemsEl.appendChild(li);
});

const savedCountry = localStorage.getItem("shippingCountry");
if (savedCountry) {
    document.getElementById("country").value = savedCountry;
}

function updateTotals() {

    const shippingPrices = {
        NL: 15,
        BE: 15,
        DE: 20,
        FR: 25,
        ES: 30,
        IT: 30,
        other: 50
    };

    const country = document.getElementById("country").value;
    const shipping = shippingPrices[country] || 0;
    const vat = subtotal * 0.21;
    const total = subtotal + shipping + vat;

    document.getElementById("subtotal").textContent = `â‚¬${subtotal.toFixed(2)}`;
    document.getElementById("shipping").textContent = `â‚¬${shipping.toFixed(2)}`;
    document.getElementById("vat").textContent = `â‚¬${vat.toFixed(2)}`;
    document.getElementById("total").textContent = `â‚¬${total.toFixed(2)}`;

    return { shipping, vat, total };
}

document.getElementById("country").addEventListener("change", updateTotals);
updateTotals();


// ðŸ”¥ FIXED SUBMIT HANDLER
document.getElementById("checkout-form").addEventListener("submit", function(e) {
    e.preventDefault();

    const totals = updateTotals();

    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const form = this;

    // Build order details
    let itemsList = cart.map(item =>
        `${item.name} x ${item.quantity} - â‚¬${(item.price * item.quantity).toFixed(2)}`
    ).join("\n");

    const orderDetails = `
Items:
${itemsList}

Subtotal: â‚¬${subtotal.toFixed(2)}
Shipping: â‚¬${totals.shipping.toFixed(2)}
VAT: â‚¬${totals.vat.toFixed(2)}
Total: â‚¬${totals.total.toFixed(2)}
    `;

    // Inject hidden field
    const hidden = document.createElement("input");
    hidden.type = "hidden";
    hidden.name = "Order Details";
    hidden.value = orderDetails;

    form.appendChild(hidden);

    // Clear cart BEFORE submit
    localStorage.removeItem("cart");
    localStorage.removeItem("shippingCountry");

    // Submit form
    form.submit();
});
});
</script>


</body>
</html>
