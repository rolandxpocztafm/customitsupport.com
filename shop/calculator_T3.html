<!-- T3 Profitability Calculator -->
<section id="calculator" class="py-16 bg-slate-900">
    <div class="container mx-auto px-6">
        <div class="max-w-4xl mx-auto profitability-calculator rounded-xl p-8">
            <h2 class="text-3xl font-bold mb-8 text-center">Fluminer T3 Profitability Calculator</h2>
            
            <!-- Live Price Display -->
            <div class="grid grid-cols-1 gap-6 mb-8">
                <div class="bg-slate-800 rounded-lg p-4 text-center">
                    <div class="text-sm text-slate-400 mb-2">Bitcoin (BTC) Price</div>
                    <div id="btc-price" class="text-xl font-bold text-orange-400">Loading...</div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <div class="mb-6">
                        <label for="electricity-cost" class="block text-sm font-medium mb-2">Electricity Cost ($/kWh)</label>
                        <input type="number" id="electricity-cost" value="0.0" step="0.01" min="0" class="w-full p-3 rounded-lg bg-slate-800 border border-slate-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <button id="calculate-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-medium transition duration-300">
                        Calculate Profitability
                    </button>
                </div>
                <div>
                    <div class="bg-slate-800 rounded-lg p-6">
                        <h3 class="text-xl font-semibold mb-4">Estimated Results</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between">
                                <span class="text-slate-300">Daily Revenue:</span>
                                <span id="daily-revenue" class="font-medium">$0.00</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-slate-300">Daily Electricity Cost:</span>
                                <span id="daily-cost" class="font-medium">$0.00</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-slate-300">Daily Profit:</span>
                                <span id="daily-profit" class="font-medium">$0.00</span>
                            </div>
                            <div class="border-t border-slate-700 my-3"></div>
                            <div class="flex justify-between">
                                <span class="text-slate-300">Monthly Profit:</span>
                                <span id="monthly-profit" class="font-medium">$0.00</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-slate-300">ROI Period:</span>
                                <span id="roi-period" class="font-medium">0 months</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-slate-300">Current Network Difficulty:</span>
                                <span id="network-difficulty" class="font-medium text-sm">Loading...</span>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 text-sm text-slate-400">
                        <p>Note: These are estimates based on current network difficulty and market conditions. Actual results may vary significantly.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    // Fetch current Bitcoin price and network difficulty
    async function fetchBitcoinData() {
        try {
            // Fetch BTC price from CoinGecko
            const priceResponse = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd', {
                headers: { 'Accept': 'application/json' }
            });
            if (!priceResponse.ok) throw new Error(`BTC price fetch failed: ${priceResponse.status}`);
            const priceData = await priceResponse.json();
            if (!priceData.bitcoin?.usd) throw new Error('Invalid BTC price data');

            // Fetch Bitcoin network difficulty from Blockchain.info
            const difficultyResponse = await fetch('https://blockchain.info/q/getdifficulty');
            if (!difficultyResponse.ok) throw new Error(`Difficulty fetch failed: ${difficultyResponse.status}`);
            const difficultyData = await difficultyResponse.text(); // Blockchain.info returns plain text
            const difficulty = parseFloat(difficultyData);
            if (isNaN(difficulty)) throw new Error('Invalid difficulty data');

            // Update price display
            document.getElementById('btc-price').textContent = `$${parseFloat(priceData.bitcoin.usd).toLocaleString()}`;
            
            // Store data for calculations
            window.bitcoinData = {
                btcPrice: priceData.bitcoin.usd,
                networkDifficulty: difficulty || 1 // Fallback to avoid division by zero
            };
            
            // Update network difficulty display
            document.getElementById('network-difficulty').textContent = `${difficulty.toLocaleString()}`;
            
        } catch (error) {
            console.error('Error fetching Bitcoin data:', error.message);
            document.getElementById('btc-price').textContent = 'Error loading price';
            document.getElementById('network-difficulty').textContent = 'Error loading difficulty';
            // Set fallback values to allow calculations
            window.bitcoinData = {
                btcPrice: 0,
                networkDifficulty: 1
            };
        }
    }

    // Calculate BTC mining profitability
    function calculateBTCProfitability(electricityCost) {
        // Fluminer T3 specifications
        const hashrate = 115; // TH/s
        const powerUsage = 1700; // Watts
        const minerPrice = 2310; // USD
        
        // Current Bitcoin data
        const btcPrice = window.bitcoinData?.btcPrice || 0;
        const networkDifficulty = window.bitcoinData?.networkDifficulty || 1;
        
        // BTC mining calculation formula
        // Daily BTC = (Hashrate * Seconds in day * Block Reward) / (Network Difficulty * 2^32)
        const blockReward = 3.125; // Current BTC block reward (post-2024 halving)
        const dailyBTC = (hashrate * 1e12 * 86400 * blockReward) / (networkDifficulty * Math.pow(2, 32));
        const dailyRevenue = dailyBTC * btcPrice;
        const dailyCost = (powerUsage * 24 / 1000) * electricityCost;
        
        return {
            dailyRevenue: dailyRevenue,
            dailyCost: dailyCost,
            minerPrice: minerPrice
        };
    }

    // Update results display
    function updateResults(dailyRevenue, dailyCost, minerPrice) {
        // Prevent negative values
        dailyRevenue = Math.max(0, dailyRevenue);
        dailyCost = Math.max(0, dailyCost);
        
        const dailyProfit = dailyRevenue - dailyCost;
        const monthlyProfit = dailyProfit * 30;
        
        // ROI calculation
        let roiPeriod = 'Not profitable';
        if (dailyProfit > 0) {
            roiPeriod = Math.ceil(minerPrice / (dailyProfit * 30)) + ' months';
        }
        document.getElementById('daily-revenue').textContent = '$' + dailyRevenue.toFixed(2);
        document.getElementById('daily-cost').textContent = '$' + dailyCost.toFixed(2);
        document.getElementById('daily-profit').textContent = '$' + dailyProfit.toFixed(2);
        document.getElementById('monthly-profit').textContent = '$' + monthlyProfit.toFixed(2);
        document.getElementById('roi-period').textContent = roiPeriod;
    }

    // Initialize event listeners and live data
    document.addEventListener('DOMContentLoaded', function() {
        fetchBitcoinData();
        
        // Update live data every 120 seconds
        setInterval(fetchBitcoinData, 120000);
        
        // Profitability calculator logic
        document.getElementById('calculate-btn').addEventListener('click', function() {
            const electricityCost = parseFloat(document.getElementById('electricity-cost').value);
            
            if (isNaN(electricityCost) || electricityCost < 0) {
                alert('Please enter a valid electricity cost');
                return;
            }
            
            const results = calculateBTCProfitability(electricityCost);
            updateResults(results.dailyRevenue, results.dailyCost, results.minerPrice);
        });
    });
</script>
