<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Profitability calculator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;max-width:920px;margin:28px auto;padding:18px}
    h1{margin:0 0 12px;font-size:20px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{display:block;font-size:13px;margin-bottom:6px}
    input,select{width:100%;padding:8px;border-radius:6px;border:1px solid #ddd}
    .card{padding:12px;border-radius:10px;background:#f8f8fb;border:1px solid #eee}
    .row{display:flex;gap:10px}
    .big{font-weight:700;font-size:18px}
    .muted{color:#666;font-size:13px}
    footer{margin-top:18px;font-size:12px;color:#666}
    @media(max-width:700px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <h1>Miner profitability calculator (static)</h1>

  <div class="grid">
    <div class="card">
      <label>Hashrate (TH/s)</label>
      <input id="hashTh" type="number" value="100" step="0.1" />

      <label style="margin-top:10px">Power (W)</label>
      <input id="powerW" type="number" value="3000" step="1" />

      <label style="margin-top:10px">Pool fee (%)</label>
      <input id="poolFee" type="number" value="1.0" step="0.1" />

      <label style="margin-top:10px">Electricity (€/kWh)</label>
      <input id="elec" type="number" value="0.22" step="0.01" />

      <label style="margin-top:10px">Block reward (BTC)</label>
      <input id="blockReward" type="number" value="6.25" step="0.0001" />

      <label style="margin-top:10px">Currency</label>
      <select id="currency">
        <option value="usd">USD</option>
        <option value="eur" selected>EUR</option>
      </select>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <div class="muted">BTC price</div>
          <div id="btcPrice" class="big">—</div>
        </div>
        <div>
          <div class="muted">Network difficulty</div>
          <div id="difficulty" class="big">—</div>
        </div>
      </div>

      <hr style="margin:12px 0">

      <div class="muted">Estimated</div>
      <div style="margin-top:8px">
        <div>BTC / day: <span id="btcDay" class="big">—</span></div>
        <div>Revenue / day: <span id="revDay" class="big">—</span></div>
        <div>Electricity / day: <span id="elecDay" class="big">—</span></div>
        <div>Profit / day: <span id="profitDay" class="big">—</span></div>
      </div>
    </div>
  </div>

  <footer>
    Live data sources: Coingecko (price) and blockchain.info (difficulty). This is client-side only.
  </footer>

<script>
(async function(){
  const el = id => document.getElementById(id);
  const inputs = ['hashTh','powerW','poolFee','elec','blockReward','currency'].map(id=>el(id));
  const out = {btcPrice:el('btcPrice'), difficulty:el('difficulty'),
               btcDay:el('btcDay'), revDay:el('revDay'), elecDay:el('elecDay'), profitDay:el('profitDay')};

  let priceData = {usd:0,eur:0};
  let difficulty = 0;

  async function fetchPrice(){
    try{
      const cur = el('currency').value;
      // Coingecko simple price: returns {bitcoin:{usd:...,eur:...}}
      const r = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd,eur');
      const j = await r.json();
      priceData.usd = j.bitcoin.usd;
      priceData.eur = j.bitcoin.eur;
      out.btcPrice.textContent = (cur === 'usd' ? priceData.usd : priceData.eur).toLocaleString(undefined,{maximumFractionDigits:2});
    }catch(e){
      out.btcPrice.textContent = 'error';
    }
  }

  async function fetchDifficulty(){
    try{
      // blockchain.info endpoint: returns plain number
      const r = await fetch('https://blockchain.info/q/getdifficulty');
      const txt = await r.text();
      difficulty = parseFloat(txt);
      out.difficulty.textContent = difficulty.toLocaleString(undefined,{maximumFractionDigits:0});
    }catch(e){
      out.difficulty.textContent = 'error';
    }
  }

  function compute(){
    // inputs
    const hashTh = parseFloat(el('hashTh').value) || 0;
    const minerHs = hashTh * 1e12; // TH/s -> H/s
    const powerW = parseFloat(el('powerW').value) || 0;
    const poolFee = (parseFloat(el('poolFee').value)||0)/100;
    const elec = parseFloat(el('elec').value) || 0;
    const blockReward = parseFloat(el('blockReward').value) || 6.25;
    const cur = el('currency').value;

    if(!difficulty || !priceData.usd){ 
      out.btcDay.textContent = '—';
      out.revDay.textContent = '—';
      out.elecDay.textContent = '—';
      out.profitDay.textContent = '—';
      return;
    }

    // BTC/day formula: minerHs * 86400 * blockReward / (difficulty * 2^32)
    const btcPerDay = minerHs * 86400 * blockReward / (difficulty * Math.pow(2,32));
    const price = (cur === 'usd' ? priceData.usd : priceData.eur);
    const revenueDay = btcPerDay * price;
    const electricityDay = (powerW/1000) * 24 * elec;
    const profitDay = revenueDay * (1 - poolFee) - electricityDay;

    out.btcDay.textContent = btcPerDay.toFixed(8);
    out.revDay.textContent = revenueDay.toLocaleString(undefined,{maximumFractionDigits:2});
    out.elecDay.textContent = electricityDay.toLocaleString(undefined,{maximumFractionDigits:2});
    out.profitDay.textContent = profitDay.toLocaleString(undefined,{maximumFractionDigits:2});
  }

  // wire inputs
  inputs.forEach(i => i.addEventListener('input', compute));
  el('currency').addEventListener('change', () => { fetchPrice().then(compute); });

  // initial fetch and periodic refresh
  await fetchPrice();
  await fetchDifficulty();
  compute();

  // refresh price often, difficulty less often
  setInterval(fetchPrice, 30_000); // price every 30s
  setInterval(fetchDifficulty, 5 * 60_000); // difficulty every 5 min
  setInterval(compute, 5_000);
})();
</script>
</body>
</html>
