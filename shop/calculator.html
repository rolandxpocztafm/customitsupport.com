<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Profitability calculator (with debug & block reward fallback)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;max-width:920px;margin:28px auto;padding:18px}
    h1{margin:0 0 12px;font-size:20px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{display:block;font-size:13px;margin-bottom:6px}
    input,select{width:100%;padding:8px;border-radius:6px;border:1px solid #ddd}
    .card{padding:12px;border-radius:10px;background:#f8f8fb;border:1px solid #eee}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .big{font-weight:700;font-size:18px}
    .muted{color:#666;font-size:13px}
    footer{margin-top:18px;font-size:12px;color:#666}
    @media(max-width:700px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <h1>Miner profitability (debug) </h1>

  <div class="grid">
    <div class="card">
      <label>Hashrate (TH/s)</label>
      <input id="hashTh" type="number" value="115" step="0.1" />

      <label style="margin-top:10px">Power (W)</label>
      <input id="powerW" type="number" value="1700" step="1" />

      <label style="margin-top:10px">Pool fee (%)</label>
      <input id="poolFee" type="number" value="1.0" step="0.1" />

      <label style="margin-top:10px">Electricity (€/kWh)</label>
      <input id="elec" type="number" value="0.05" step="0.01" />

      <label style="margin-top:10px">Block reward (BTC, live)</label>
      <input id="blockReward" type="number" value="0" step="0.0001" readonly />

      <label style="margin-top:10px">Currency</label>
      <select id="currency">
        <option value="usd">USD</option>
        <option value="eur" selected>EUR</option>
      </select>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <div class="muted">BTC price</div>
          <div id="btcPrice" class="big">—</div>
        </div>
        <div>
          <div class="muted">Network difficulty</div>
          <div id="difficulty" class="big">—</div>
        </div>
        <div>
          <div class="muted">Block reward</div>
          <div id="rewardLive" class="big">—</div>
        </div>
      </div>

      <hr style="margin:12px 0">

      <div class="muted">Estimated</div>
      <div style="margin-top:8px">
        <div>BTC / day: <span id="btcDay" class="big">—</span></div>
        <div>Revenue / day: <span id="revDay" class="big">—</span></div>
        <div>Electricity / day: <span id="elecDay" class="big">—</span></div>
        <div>Profit / day: <span id="profitDay" class="big">—</span></div>
      </div>
    </div>
  </div>

  <footer>
    Debug mode: check console logs for errors and responses.
  </footer>

<script>
(async function(){
  const el = id => document.getElementById(id);
  const inputs = ['hashTh','powerW','poolFee','elec','currency'].map(id=>el(id));
  const out = {
    btcPrice: el('btcPrice'),
    difficulty: el('difficulty'),
    rewardLive: el('rewardLive'),
    btcDay: el('btcDay'),
    revDay: el('revDay'),
    elecDay: el('elecDay'),
    profitDay: el('profitDay')
  };

  let priceData = {usd:0,eur:0};
  let difficulty = 0;
  let blockReward = 0;

  async function fetchPrice(){
    try {
      const url = 'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd,eur';
      console.log('fetchPrice url', url);
      const r = await fetch(url);
      console.log('fetchPrice status', r.status);
      const j = await r.json();
      console.log('fetchPrice json', j);
      if (j.bitcoin) {
        priceData = j.bitcoin;
        const cur = el('currency').value;
        out.btcPrice.textContent = (cur === 'usd' ? priceData.usd : priceData.eur).toLocaleString(undefined, { maximumFractionDigits:2 });
      } else {
        throw new Error('no bitcoin field');
      }
    } catch (e) {
      console.error('fetchPrice error', e);
      out.btcPrice.textContent = 'error';
    }
  }

  async function fetchDifficulty(){
    try {
      const url = 'https://blockchain.info/q/getdifficulty';
      console.log('fetchDifficulty url', url);
      const r = await fetch(url);
      console.log('fetchDifficulty status', r.status);
      const txt = await r.text();
      console.log('fetchDifficulty text', txt);
      difficulty = parseFloat(txt);
      if (!isNaN(difficulty)) {
        out.difficulty.textContent = difficulty.toLocaleString(undefined, {
